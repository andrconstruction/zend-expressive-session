<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sessions and session middleware for PSR-7 applications.">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Session Middleware - zend-expressive-session</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/styles-482aa2add1.css">

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
                <a href="..">zend-expressive-session</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../intro/">Introduction</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Usage <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../session/">Session Containers</a>
</li>

                        
                            
<li >
    <a href="../persistence/">Session Persistence</a>
</li>

                        
                            
<li class="active">
    <a href="./">Session Middleware</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Show component list">
                        <i class="fa fa-book"></i> Components
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/zendframework/zend-expressive-session">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <!-- content:begin -->
    <div id="page-top" class="container docs">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#session-middleware">Session Middleware</a></li>
        
            <li><a href="#configuration">Configuration</a></li>
        
            <li><a href="#adding-the-middleware-to-your-application">Adding the middleware to your application</a></li>
        
    
    </ul>

    
</div></div>
        <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="..">zend-expressive-session</a></li>
  
    
      
        <li>Usage</li>
      
    
  
  <li class="active">Session Middleware</li>
</ol>

<h1 id="session-middleware">Session Middleware</h1>
<p>zend-expressive-session provides middleware consuming
<a href="http://www.php-fig.org/psr/psr-7/">PSR-7</a> HTTP message instances, via
implementation of <a href="https://github.com/http-interop/http-middleware">http-interop/http-middleware</a>
interfaces.</p>
<p>This middleware composes a <a href="../persistence/">persistence</a> instance, and uses that
in order to generate a session container, which it pushes into the request it
delegates to the next middleware. Once a response is returned, it uses the
persistence instance to persist the session data and provide information back to
the client.</p>
<p>The above two paragraphs are longer than the body of the middleware
implementation:</p>
<pre class="codehilite"><code class="language-php">namespace Zend\Expressive\Session;

use Interop\Http\ServerMiddleware\DelegateInterface;
use Interop\Http\ServerMiddleware\MiddlewareInterface;
use Psr\Http\Message\ServerRequestInterface;
use Psr\Http\Message\ResponseInterface;

class SessionMiddleware implements MiddlewareInterface
{
    const SESSION_ATTRIBUTE = 'session';

    private $persistence;

    public function __construct(SessionPersistenceInterface $persistence)
    {
        $this-&gt;persistence = $persistence;
    }

    public function process(ServerRequestInterface $request, DelegateInterface $delegate) : ResponseInterface
    {
        $session = new LazySession($this-&gt;persistence, $request);
        $response = $delegate-&gt;process($request-&gt;withAttribute(self::SESSION_ATTRIBUTE, $session));
        return $this-&gt;persistence-&gt;persistSession($session, $response);
    }
}</code></pre>


<h2 id="configuration">Configuration</h2>
<p>This package provides a factory for <code>Zend\Expressive\Session\SessionMiddleware</code>
via <code>Zend\Expressive\Session\SessionMiddlewareFactory</code>; this factory is
auto-wired if you are using Expressive and the zend-component-installer Composer
plugin. If not, you will need to wire these into your application.</p>
<p>The factory depends on one service: <code>Zend\Expressive\Session\SessionPersistenceInterface</code>.
You will need to either wire in your persistence implementation of choice, or
have the package providing it do so for you.</p>
<h2 id="adding-the-middleware-to-your-application">Adding the middleware to your application</h2>
<p>You may pipe this middleware anywhere in your application. If you want to have
it available anywhere, pipe it early in your application, prior to any routing.
As an example, within Expressive, you could pipe it in the <code>config/pipeline.php</code>
file:</p>
<pre class="codehilite"><code class="language-php">$app-&gt;pipe(\Zend\Expressive\Session\SessionMiddleware::class);
$app-&gt;pipeRoutingMiddleware();</code></pre>


<p>This will generally be an inexpensive operation; since the middleware uses a
<code>LazySession</code> instance, unless your persistence implementation does any work in
its constructor, the cost is just that of instantiating a few objects.</p>
<p>However, it's often useful to specifically include such middleware directly in
the routed middleware pipelines, to ensure other developers are aware of its
presence in that route's workflow.</p>
<p>Within Expressive, you can do this when routing, in your <code>config/routes.php</code>
file, or within a <a href="https://docs.zendframework.com/zend-expressive/cookbook/autowiring-routes-and-pipelines/#delegator-factories">delegator factory</a>:</p>
<pre class="codehilite"><code class="language-php">$app-&gt;post('/login', [
    \Zend\Expressive\Session\SessionMiddleware::class,
    \User\Middleware\LoginHandler::class
]);</code></pre>

<hr />

</div>
        
    </div>
    <!-- content:end -->

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="https://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2017 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="https://discourse.zendframework.com" class="btn-social btn-outline" alt="Forum" title="Forum"><i class="fa fa-comments"></i></a>
                    <a href="https://zendframework-slack.herokuapp.com" class="btn-social btn-outline" alt="Slack" title="Slack"><i class="fa fa-slack"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <script>var base_url = '..';</script>
    <script src="../js/scripts-019f7ac1f7.js"></script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="https://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Hide list</a></p>
  </div>
</div>

</body>

</html>
